<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.min.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap-responsive.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}"/>
    <script type="text/javascript" th:href="@{/js/bootstrap.js}">
    </script>

    <script>
        path = window.location.host

        function addGroupEdit() {
            let lst = document.getElementById("list-groups")
            let element = document.createElement("input")
            element.setAttribute("type", "text")
            element.setAttribute("id", "group-edit")

            lst.appendChild(element)
            element.addEventListener('focusout', function (event) {
                if ((element.value == null) || (element.value === "")) {
                    element.remove()
                } else {
                    axios.get("/request/new_group", {
                        withCredentials: true,
                        params: {
                            "name": element.value
                        }
                    }).then(res => {
                        location.reload()
                    });
                }
            });
            element.focus()
        }

    </script>

    <title>Notes</title>

</head>


<body class="back-color-main">
<div class="row-fluid">
    <div class="span2 back-color-md p-3">
        <div>
            <table>
                <tr>
                    <td>
                        <p class="text-color-light">Пользователь:</p>
                        <h3 class="text-color-light" th:text="${user.username}"></h3>
                    </td>
                </tr>
            </table>
        </div>
        <hr/>
        <p></p>
        <form th:action="@{/profile}" method="get">
            <input type="submit" value="Профиль" class="btn back-color-md text-color-ref"/>
        </form>
        <p></p>
        <form th:action="@{/settings}" method="get">
            <input type="submit" value="Настройки" class="btn back-color-md text-color-ref"/>
        </form>
        <p></p>
        <form th:action="@{/colors}" method="get">
            <input type="submit" value="Цветовая схема" class="btn back-color-md text-color-ref"/>
        </form>
        <hr/>
        <p></p>
        <form th:action="@{/logout}" method="post">
            <input type="submit" value="Выход" class="btn back-color-md font-red"/>
        </form>

        <hr/>
        <form th:action="@{/about}" method="get">
            <input type="submit" value="О сайте" class="btn back-color-md text-color-ref"/>
        </form>
    </div>
    <div class="span4 border">
        <p></p>
        <form method="get">
            <fieldset>
                <div class ="row-fluid">
                    <div class="span8">
                        <input type="search" placeholder="Поиск" name="search" class="row-fluid search-query text-color-light back-color-md"
                        style="border:0"/>
                    </div>
                    <div class="span3">
                        <input type="submit" class="btn back-color-md" value="Найти"/>
                    </div>
                </div>

                <div class ="row-fluid">
                    <div class="span6">
                        <label class="check-box">
                            <input type="checkbox" name="search_groups"/> По группам
                        </label>
                    </div>
                    <div class="span6">
                        <label class="check-box">
                            <input type="checkbox" name="search_notes"/> По заметкам
                        </label>
                    </div>
                </div>
            </fieldset>
        </form>
        <hr/>
        <div class ="row-fluid">
            <div class="span5">
                <div id = "list-groups">
                    <div class ="mark-block" th:each="group: ${groups}">
                        <a class = "btn d-block mark-block p-0 m-0" th:href="'/home/'+${group.id} + '/-1'">
                            <div class="back-color-md fill-block" th:if="${group.id eq selectedGroup}">
                                <p class="p-0 m-0" th:text="${group.name}"></p>
                                <p class="p-0 m-0"></p>
                            </div>
                            <div class = "flex-fill" th:unless="${group.id} eq ${selectedGroup}">
                                <p class="p-0 m-0" th:text="${group.name}"></p>
                                <p class="p-0 m-0"></p>
                            </div>
                        </a>
                        <hr class="p-0 m-0"/>
                    </div>
                </div>
                <div class="mark-block text-center">
                    <button class="btn back-color-md" onclick="addGroupEdit()">
                        +
                    </button>
                </div>
            </div>
            <div class="span5">
                <div class ="mark-block" th:each="note: ${notes}">
                    <a class = "btn d-block mark-block p-0 m-0" th:href="'/home/'+${selectedGroup}+'/'+${note.id}">
                        <div class="back-color-md fill-block" th:if="${noteIsSelected and (note.id eq selectedNote)}">
                            <p class="p-0 m-0" th:text="${note.name}"></p>
                            <p class="p-0 m-0" th:text="${note.description}"></p>
                        </div>
                        <div class = "flex-fill" th:unless="${noteIsSelected and (note.id eq selectedNote)}">
                            <p class="p-0 m-0" th:text="${note.name}"></p>
                            <p class="p-0 m-0" th:text="${note.description}"></p>
                        </div>
                    </a>
                    <hr class="p-0 m-0"/>
                </div>
                <div class="mark-block text-center" >
                    <form th:action="'/request/new_note/'+${selectedGroup}" method="post">
                        <input type="submit" class="btn back-color-md" value="+"/>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="span5">
        <div class="back-color-md border">
            <h1 class="text-color-light">Notes</h1>
            <p  class="text-color-light">© Круглов Игорь 2021</p>
        </div>
        <div th:if="${noteIsSelected}">
            <p></p>
            <form th:action="'/request/save/'+${selectedNote}" th:object="${note}" method="post">
                <input type="text" placeholder="Название заметки" th:field="${note.name}" class="input-medium search-query text-color-light back-color-md input-field-name"/>
                <p></p>
                <textarea class="back-color-md text-color-light input-field-main" placeholder="Заметка" th:field="${note.content}"></textarea>
                <p></p>
                <input type="submit" class="btn back-color-md" value="Сохранить"/>
            </form>
        </div>
    </div>
</div>



</body>
</html>